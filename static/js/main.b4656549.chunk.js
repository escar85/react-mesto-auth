(this["webpackJsonpmesto-react-auth"]=this["webpackJsonpmesto-react-auth"]||[]).push([[0],{20:function(e,t,a){e.exports=a.p+"static/media/logo__mesto.4e5bdbab.svg"},24:function(e,t,a){e.exports=a(35)},29:function(e,t,a){},35:function(e,t,a){"use strict";a.r(t);var n=a(0),o=a.n(n),c=a(19),r=a.n(c),s=(a(29),a(22)),i=a(1),l=a(2),u=o.a.createContext(),m=a(12),p=a(13),d=new(function(){function e(t){Object(m.a)(this,e),this._baseUrl=t.baseUrl,this._headers=t.headers}return Object(p.a)(e,[{key:"getUserInfo",value:function(){return fetch("".concat(this._baseUrl,"/users/me"),{method:"GET",headers:this._headers}).then((function(e){return e.ok?e.json():Promise.reject("\u041e\u0448\u0438\u0431\u043a\u0430: ".concat(e.status))})).catch((function(e){console.log(e)}))}},{key:"setUserInfo",value:function(e){return fetch("".concat(this._baseUrl,"/users/me"),{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e.name,about:e.about})}).then((function(e){return e.ok?e.json():Promise.reject("\u041e\u0448\u0438\u0431\u043a\u0430: ".concat(e.status))})).catch((function(e){console.log(e)}))}},{key:"getInitialCards",value:function(){return fetch("".concat(this._baseUrl,"/cards"),{method:"GET",headers:this._headers}).then((function(e){return e.ok?e.json():Promise.reject("\u041e\u0448\u0438\u0431\u043a\u0430: ".concat(e.status))})).catch((function(e){console.log(e)}))}},{key:"addCard",value:function(e){return fetch("".concat(this._baseUrl,"/cards"),{method:"POST",headers:this._headers,body:JSON.stringify({name:e.name,link:e.link})}).then((function(e){return e.ok?e.json():Promise.reject("\u041e\u0448\u0438\u0431\u043a\u0430: ".concat(e.status))})).catch((function(e){console.log(e)}))}},{key:"changeLikeCardStatus",value:function(e,t){return fetch("".concat(this._baseUrl,"/cards/likes/").concat(e),{method:t?"PUT":"DELETE",headers:this._headers}).then((function(e){return e.ok?e.json():Promise.reject("\u041e\u0448\u0438\u0431\u043a\u0430: ".concat(e.status))})).catch((function(e){console.log(e)}))}},{key:"setUserAvatar",value:function(e){return fetch("".concat(this._baseUrl,"/users/me/avatar"),{method:"PATCH",headers:this._headers,body:JSON.stringify(e)}).then((function(e){return e.ok?e.json():Promise.reject("\u041e\u0448\u0438\u0431\u043a\u0430: ".concat(e.status))})).catch((function(e){console.log(e)}))}},{key:"deleteCard",value:function(e){return fetch("".concat(this._baseUrl,"/cards/").concat(e),{method:"DELETE",headers:this._headers}).then((function(e){return e.ok?e.json():Promise.reject("\u041e\u0448\u0438\u0431\u043a\u0430: ".concat(e.status))})).catch((function(e){console.log(e)}))}}]),e}())({baseUrl:"https://mesto.nomoreparties.co/v1/cohort-13",headers:{authorization:"b8b572e2-0aa8-4f92-a0e1-a67154852e96","Content-Type":"application/json"}}),f=new(function(){function e(t){Object(m.a)(this,e),this._baseUrl=t.baseUrl,this._headers=t.headers}return Object(p.a)(e,[{key:"registerUser",value:function(e){return fetch("".concat(this._baseUrl,"/signup"),{method:"POST",headers:this._headers,body:JSON.stringify({password:e.password,email:e.email})}).then((function(e){return e.ok?e.json():Promise.reject("\u041e\u0448\u0438\u0431\u043a\u0430: ".concat(e.status))})).catch((function(e){console.log(e)}))}},{key:"loginUser",value:function(e){return fetch("".concat(this._baseUrl,"/signin"),{method:"POST",headers:this._headers,body:JSON.stringify({password:e.password,email:e.email})}).then((function(e){return e.ok?e.json():Promise.reject("\u041e\u0448\u0438\u0431\u043a\u0430: ".concat(e.status))})).then((function(e){return e.token?(localStorage.setItem("token",e.token),e):void 0})).catch((function(e){console.log(e)}))}},{key:"getContent",value:function(e){return fetch("".concat(this._baseUrl,"/users/me"),{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer ".concat(e)}}).then((function(e){return e.json()})).then((function(e){return e})).catch((function(e){console.log(e)}))}}]),e}())({baseUrl:"https://auth.nomoreparties.co",headers:{"Content-Type":"application/json"}}),h=a(7),_=a(20),b=a.n(_);var E=function(e){var t=o.a.useState(""),a=Object(i.a)(t,2),n=a[0],c=a[1],r=o.a.useState(""),s=Object(i.a)(r,2),u=s[0],m=s[1],p=Object(l.h)();return o.a.useEffect((function(){"/sign-in"===p.pathname?(c("/sign-up"),m("\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c\u0441\u044f")):(c("/sign-in"),m("\u0412\u043e\u0439\u0442\u0438"))})),o.a.createElement("header",{className:"header"},o.a.createElement("img",{src:b.a,alt:"\u043c\u0435\u0441\u0442\u0430 \u0420\u043e\u0441\u0441\u0438\u0438",className:"header__logo"}),o.a.createElement("div",{className:"header__box"},e.loggedIn?o.a.createElement(o.a.Fragment,null,o.a.createElement("h3",{className:"header__user-email"},e.email),o.a.createElement(h.b,{to:"/sign-in",onClick:e.signOut,className:"header__link"},"\u0412\u044b\u0439\u0442\u0438")):o.a.createElement(h.b,{to:n,className:"header__link"},u)))};var g=function(e){var t=o.a.useContext(u),a=e.card.owner._id===t._id,n=e.card.likes.some((function(e){return e._id===t._id})),c="element__delete-button ".concat(a?"":"element__delete-button_hidden"),r="element__like-button ".concat(n?"element__like-button_active":"");return o.a.createElement("li",{className:"element"},o.a.createElement("img",{alt:e.card.name,className:"element__image",src:e.card.link,onClick:function(){e.onCardClick(e.card)}}),o.a.createElement("button",{type:"button","aria-label":"delete",className:c,onClick:function(){e.onCardDelete(e.card)}}),o.a.createElement("div",{className:"element__info"},o.a.createElement("h2",{className:"element__title"},e.card.name),o.a.createElement("div",{className:"element__like-area"},o.a.createElement("button",{type:"button","aria-label":"like",className:r,onClick:function(){e.onCardLike(e.card)}}),o.a.createElement("span",{className:"element__like-count"},e.card.likes.length))))};var v=function(e){var t=o.a.useContext(u);return o.a.createElement(o.a.Fragment,null,o.a.createElement("section",{className:"profile"},o.a.createElement("div",{className:"profile__info"},o.a.createElement("img",{alt:"\u0430\u0432\u0430\u0442\u0430\u0440 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f",src:t.avatar,className:"profile__avatar",onClick:e.onEditAvatar}),o.a.createElement("div",{className:"profile__block"},o.a.createElement("div",{className:"profile__name-area"},o.a.createElement("h1",{className:"profile__name"},t.name),o.a.createElement("button",{type:"button","aria-label":"edit-profile",className:"profile__edit-button",onClick:e.onEditProfile})),o.a.createElement("p",{className:"profile__job"},t.about))),o.a.createElement("button",{type:"button","aria-label":"add-card",className:"profile__card-add-button",onClick:e.onAddPlace})),o.a.createElement("ul",{className:"elements"},e.cards.map((function(t,a){return o.a.createElement(g,{card:t,key:a,onCardClick:e.onCardClick,onCardLike:e.onCardLike,onCardDelete:e.onCardDelete})}))))};var k=function(){return o.a.createElement("footer",{className:"footer"},o.a.createElement("p",{className:"footer__copyright"},"\xa9 2020 Mesto Russia"))};var N=function(e){return o.a.createElement("section",{className:"popup ".concat(e.isOpen?"popup_opened":""," popup-").concat(e.name)},o.a.createElement("form",{name:e.name,onSubmit:e.onSubmit,method:"post",action:"#",className:"popup__container",id:e.name,noValidate:!0},o.a.createElement("h3",{className:"popup__title"},e.title),e.children,o.a.createElement("button",{type:"submit",className:"popup__submit-button"},"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c"),o.a.createElement("button",{type:"button","aria-label":"close",className:"popup__close-button",onClick:e.onClose})))};var C=function(e){var t=o.a.useContext(u),a=o.a.useState(""),n=Object(i.a)(a,2),c=n[0],r=n[1],s=o.a.useState(""),l=Object(i.a)(s,2),m=l[0],p=l[1];return o.a.useEffect((function(){r(t.name),p(t.about)}),[t]),o.a.createElement(N,{name:"profile",title:"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043f\u0440\u043e\u0444\u0438\u043b\u044c",isOpen:e.isOpen,onClose:e.onClose,onSubmit:function(t){t.preventDefault(),e.onUpdateUser({name:c,about:m})}},o.a.createElement("input",{type:"text",name:"name",required:!0,minLength:"2",maxLength:"40",className:"popup__input",id:"inputName",defaultValue:c,onChange:function(e){r(e.target.value)}}),o.a.createElement("span",{className:"popup__input_type_error",id:"inputName-error"}),o.a.createElement("input",{type:"text",name:"about",required:!0,minLength:"2",maxLength:"200",className:"popup__input",id:"inputJob",defaultValue:m,onChange:function(e){p(e.target.value)}}),o.a.createElement("span",{className:"popup__input_type_error",id:"inputJob-error"}))};var y=function(e){var t=o.a.useRef();return o.a.useEffect((function(){t.current.value=""}),[e.isOpen]),o.a.createElement(N,{name:"avatar",title:"\u041e\u0431\u043d\u043e\u0432\u0438\u0442\u044c \u0430\u0432\u0430\u0442\u0430\u0440",isOpen:e.isOpen,onClose:e.onClose,onSubmit:function(a){a.preventDefault(),e.onUpdateAvatar({avatar:t.current.value})}},o.a.createElement("input",{type:"url",name:"avatar",ref:t,placeholder:"\u0421\u0441\u044b\u043b\u043a\u0430 \u043d\u0430 \u043a\u0430\u0440\u0442\u0438\u043d\u043a\u0443",required:!0,className:"popup__input",id:"linkAvatar"}),o.a.createElement("span",{className:"popup__input_type_error",id:"linkAvatar-error"}))};var O=function(e){var t=o.a.useRef(),a=o.a.useRef();return o.a.useEffect((function(){t.current.value="",a.current.value=""}),[e.isOpen]),o.a.createElement(N,{name:"add-card",title:"\u041d\u043e\u0432\u043e\u0435 \u043c\u0435\u0441\u0442\u043e",isOpen:e.isOpen,onClose:e.onClose,onSubmit:function(n){n.preventDefault(),e.onAddPlace({name:t.current.value,link:a.current.value})}},o.a.createElement("input",{type:"text",name:"name",placeholder:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435",ref:t,defaultValue:"",required:!0,minLength:"1",maxLength:"30",className:"popup__input",id:"cardName"}),o.a.createElement("span",{className:"popup__input_type_error",id:"cardName-error"}),o.a.createElement("input",{type:"url",name:"link",ref:a,placeholder:"\u0421\u0441\u044b\u043b\u043a\u0430 \u043d\u0430 \u043a\u0430\u0440\u0442\u0438\u043d\u043a\u0443",defaultValue:"",required:!0,className:"popup__input",id:"linkPhoto"}),o.a.createElement("span",{className:"popup__input_type_error",id:"linkPhoto-error"}))};var j=function(e){return o.a.createElement("figure",{className:"popup popup_big-image ".concat(e.card&&"popup_opened")},o.a.createElement("div",{className:"popup__image-box"},o.a.createElement("img",{alt:e.card?e.card.name:"",className:"popup__image",src:e.card?e.card.link:""}),o.a.createElement("figcaption",{className:"popup__image-caption"},e.card?e.card.name:""),o.a.createElement("button",{type:"button","aria-label":"close",className:"popup__close-button",onClick:e.onClose})))};var S=function(e){return o.a.createElement("section",{className:"popup popup-delete-card ".concat(e.isOpen?"popup_opened":""),onSubmit:function(t){t.preventDefault(),e.onCardDelete(e.isOpen)}},o.a.createElement("form",{name:"delete-card",method:"post",action:"#",className:"popup__container",id:"deleteCardForm",noValidate:!0},o.a.createElement("h3",{className:"popup__title"},"\u0412\u044b \u0443\u0432\u0435\u0440\u0435\u043d\u044b?"),o.a.createElement("button",{type:"submit",className:"popup__submit-button"},"\u0414\u0430"),o.a.createElement("button",{type:"button","aria-label":"close",className:"popup__close-button",onClick:e.onClose})))};var U=function(e){var t=o.a.useState(""),a=Object(i.a)(t,2),n=a[0],c=a[1],r=o.a.useState(""),s=Object(i.a)(r,2),l=s[0],u=s[1];return o.a.createElement("form",{name:"login",onSubmit:function(t){t.preventDefault(),e.onLogin({password:l,email:n})},method:"post",action:"#",className:"entry-form",noValidate:!0},o.a.createElement("h3",{className:"entry-form__title"},"\u0412\u0445\u043e\u0434"),o.a.createElement("input",{type:"email",name:"email",placeholder:"Email",defaultValue:n,required:!0,minLength:"5",maxLength:"30",className:"entry-form__input",onChange:function(e){c(e.target.value)}}),o.a.createElement("input",{type:"password",name:"password",placeholder:"\u041f\u0430\u0440\u043e\u043b\u044c",defaultValue:l,required:!0,minLength:"5",maxLength:"30",className:"entry-form__input",onChange:function(e){u(e.target.value)}}),o.a.createElement("button",{type:"submit",className:"entry-form__submit-button"},"\u0412\u043e\u0439\u0442\u0438"),o.a.createElement(h.b,{to:"/sign-up",className:"entry-form__link"},"\u0415\u0449\u0451 \u043d\u0435 \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u043d\u044b? \u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f"))};var L=function(e){var t=o.a.useState(""),a=Object(i.a)(t,2),n=a[0],c=a[1],r=o.a.useState(""),s=Object(i.a)(r,2),l=s[0],u=s[1];return o.a.createElement("form",{name:"register",onSubmit:function(t){t.preventDefault(),e.onRegister({password:l,email:n})},method:"post",action:"#",className:"entry-form",noValidate:!0},o.a.createElement("h3",{className:"entry-form__title"},"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f"),o.a.createElement("input",{type:"email",name:"email",placeholder:"Email",defaultValue:n,required:!0,minLength:"5",maxLength:"30",className:"entry-form__input",onChange:function(e){c(e.target.value)}}),o.a.createElement("input",{type:"password",name:"password",placeholder:"\u041f\u0430\u0440\u043e\u043b\u044c",defaultValue:l,required:!0,minLength:"5",maxLength:"30",className:"entry-form__input",onChange:function(e){u(e.target.value)}}),o.a.createElement("button",{type:"submit",className:"entry-form__submit-button"},"\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c\u0441\u044f"),o.a.createElement(h.b,{to:"/sign-in",className:"entry-form__link"},"\u0423\u0436\u0435 \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u043d\u044b? \u0412\u043e\u0439\u0442\u0438"))};var P=function(e){return o.a.createElement("section",{className:"popup ".concat(e.isOpen?"popup_opened":"")},o.a.createElement("div",{className:"popup__container"},o.a.createElement("div",{className:"popup__infoTooltip-image_".concat(e.isSuccess?"success":"error")}),o.a.createElement("h3",{className:"popup__infoTooltip-title"}," ".concat(e.isSuccess?"\u0412\u044b \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u043b\u0438\u0441\u044c!":"\u0427\u0442\u043e-\u0442\u043e \u043f\u043e\u0448\u043b\u043e \u043d\u0435 \u0442\u0430\u043a! \u041f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0435\u0449\u0435 \u0440\u0430\u0437.")),o.a.createElement("button",{type:"button","aria-label":"close",className:"popup__close-button",onClick:e.onClose})))},w=a(23);var x=function(e){var t=e.component,a=Object(w.a)(e,["component"]);return o.a.createElement(l.b,null,a.loggedIn?o.a.createElement(t,a):o.a.createElement(l.a,{to:"/sign-in"}))};var T=function(){var e=o.a.useState(!1),t=Object(i.a)(e,2),a=t[0],c=t[1],r=o.a.useState(!1),m=Object(i.a)(r,2),p=m[0],h=m[1],_=o.a.useState(!1),b=Object(i.a)(_,2),g=b[0],N=b[1],w=o.a.useState(!1),T=Object(i.a)(w,2),A=T[0],D=T[1],I=o.a.useState(!1),V=Object(i.a)(I,2),q=V[0],J=V[1],R=o.a.useState(),B=Object(i.a)(R,2),F=B[0],G=B[1],z=o.a.useState([]),H=Object(i.a)(z,2),M=H[0],W=H[1],$=o.a.useState([]),K=Object(i.a)($,2),Q=K[0],X=K[1],Y=o.a.useState(!1),Z=Object(i.a)(Y,2),ee=Z[0],te=Z[1],ae=o.a.useState(!1),ne=Object(i.a)(ae,2),oe=ne[0],ce=ne[1],re=o.a.useState(""),se=Object(i.a)(re,2),ie=se[0],le=se[1],ue=Object(l.g)();function me(){c(!1),h(!1),N(!1),G(void 0),J(!1),D(!1)}function pe(){var e=localStorage.getItem("token");e&&f.getContent(e).then((function(e){le(e.data.email),te(!0),ue.push("/")}))}return o.a.useEffect((function(){Promise.all([d.getInitialCards(),d.getUserInfo()]).then((function(e){var t=Object(i.a)(e,2),a=t[0],n=t[1];X(a),W(n)})).catch((function(e){console.log(e)}))}),[]),o.a.useEffect((function(){function e(e){("Escape"===e.key||e.target.classList.contains("popup_opened"))&&me()}return document.addEventListener("click",e),document.addEventListener("keydown",e),function(){document.removeEventListener("click",e),document.removeEventListener("keydown",e)}})),Object(n.useEffect)((function(){pe()}),[]),o.a.createElement("div",{className:"root"},o.a.createElement(u.Provider,{value:M},o.a.createElement(E,{linkTo:"/sign-up",linkTitle:"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f",signOut:function(){localStorage.removeItem("token"),le(""),te(!1)},email:ie,loggedIn:ee}),o.a.createElement(l.d,null,o.a.createElement(x,{exact:!0,path:"/",loggedIn:ee,component:v,onEditProfile:function(){c(!0)},onEditAvatar:function(){N(!0)},onAddPlace:function(){h(!0)},onCardClick:function(e){G(e)},onCardLike:function(e){var t=e.likes.some((function(e){return e._id===M._id}));d.changeLikeCardStatus(e._id,!t).then((function(t){var a=Q.map((function(a){return a._id===e._id?t:a}));X(a)})).catch((function(e){console.log(e)}))},onCardDelete:function(e){J(e)},cards:Q}),o.a.createElement(l.b,{path:"/sign-up"},o.a.createElement(L,{onRegister:function(e){f.registerUser(e).then((function(e){e&&(ce(!0),ue.push("/sign-in"))})).catch((function(e){console.log(e)})).finally((function(){D(!0)}))}})),o.a.createElement(l.b,{path:"/sign-in"},o.a.createElement(U,{onLogin:function(e){f.loginUser(e).then((function(e){return pe(),e.token}),te(!0),ue.push("/")).catch((function(e){console.log(e)}))}})),o.a.createElement(l.b,null,ee?o.a.createElement(l.a,{to:"/"}):o.a.createElement(l.a,{to:"/sign-in"}))),o.a.createElement(k,null),o.a.createElement(P,{isOpen:A,onClose:me,isSuccess:oe}),o.a.createElement(C,{isOpen:a,onClose:me,onUpdateUser:function(e){d.setUserInfo(e).then((function(e){W(e),me()})).catch((function(e){console.log(e)}))}}),o.a.createElement(y,{isOpen:g,onClose:me,onUpdateAvatar:function(e){d.setUserAvatar(e).then((function(e){W(e),me()})).catch((function(e){console.log(e)}))}}),o.a.createElement(O,{isOpen:p,onClose:me,onAddPlace:function(e){d.addCard(e).then((function(e){X([].concat(Object(s.a)(Q),[e])),me()})).catch((function(e){console.log(e)}))}}),o.a.createElement(j,{card:F,onClose:me}),o.a.createElement(S,{isOpen:q,onClose:me,onCardDelete:function(e){d.deleteCard(e._id).then((function(){var t=Q.filter((function(t){return t._id!==e._id}));X(t),me()})).catch((function(e){console.log(e)}))}})))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(o.a.createElement(o.a.StrictMode,null,o.a.createElement(h.a,null,o.a.createElement(T,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[24,1,2]]]);
//# sourceMappingURL=main.b4656549.chunk.js.map